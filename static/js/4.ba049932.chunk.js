(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{355:function(e,t,n){"use strict";n.r(t);var r=n(22),a=n(3),c=n(10),i=n.n(c),u=n(21),o=n(2),l=n(0),s=n.n(l),f=n(14),d=n.n(f),m=n(12),p=n(1),h=function(e){return new Promise(function(t,n){var r=new Image;r.onload=function(){return t(r)},r.onerror=function(e){return n(e)},r.src=e})},v=function(e,t){return Object(a.a)({},e,t)};function b(e){try{var t=e.split("/").pop().split("."),n=Object(o.a)(t,1)[0],r=/\d+/.exec(n),a=Object(o.a)(r,1)[0];if(!a)throw Error();return parseInt(a,10)}catch(c){console.error('"'.concat(e,'" does not contain a valid frame index'))}}function g(e,t){return b(e)-b(t)}var j=function(e){var t=e.fps,n=void 0===t?24:t,r=e.frames,c=void 0===r?[]:r,s=Object(l.useMemo)(function(){return c.sort(g)},[c]),f=Object(l.useRef)(null),d=Object(l.useRef)(),m=Object(l.useRef)(null),p=Object(l.useReducer)(v,{currentFrame:0,isPlaying:!1,htmlImageElements:[]}),b=Object(o.a)(p,2),j=b[0],O=b[1],w=j.isPlaying,y=j.htmlImageElements;function E(e){e&&m.current&&(m.current.width=e.width,m.current.height=e.height,m.current.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,e.width,e.height))}return Object(l.useEffect)(function(){m&&Object(u.a)(i.a.mark(function e(){var t,n,r,a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(s.map(function(e){return h(e)}));case 2:if((t=e.sent)&&0!==t.length){e.next=5;break}return e.abrupt("return");case 5:n=t[0],r=n.width,a=n.height,O({htmlImageElements:t,frameSize:{width:r,height:a}}),E(t[0]);case 7:case"end":return e.stop()}},e)}))()},[c,m,s]),Object(l.useEffect)(function(){if(w){if(!j.isPlaying)return;var e,t,r=performance.now();!function a(){if(j.isPlaying){e=performance.now(),t=e-r;var i=Math.round(1e3/n);if(t>i){var u=f.current;r=e,f.current=u===c.length-1?0:u+1,E(y[f.current])}d.current=requestAnimationFrame(a)}}()}else d.current&&cancelAnimationFrame(d.current)},[n,c.length,y,w,j.isPlaying]),Object(a.a)({},j,{canvasRef:m,togglePlay:function(){var e=y.length>0&&!w;O({isPlaying:e})},sortedFrames:s})};function O(e){var t=e.frames,n=j({frames:t}),r=n.canvasRef,a=n.togglePlay,c=n.isPlaying;return s.a.createElement("div",{style:{position:"relative",maxWidth:800}},s.a.createElement("div",{style:{padding:"8px 0 8px"}},s.a.createElement("button",{onClick:a},c?"pause":"play")),s.a.createElement("canvas",{style:{maxWidth:"100%"},ref:r}))}function w(e){var t=e.onSelectFolder,n=e.selectedFolderId,r=Object(l.useState)(null),a=Object(o.a)(r,2),c=a[0],f=a[1],d=Object(p.n)().client;return Object(l.useEffect)(function(){function e(){return(e=Object(u.a)(i.a.mark(function e(){var t,n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.filesListFolder({path:""});case 2:t=e.sent,n=t.entries.filter(function(e){return"folder"===e[".tag"]&&"images"!==e.name}),f(n);case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}!function(){e.apply(this,arguments)}()},[]),null===c?s.a.createElement(m.a,null):s.a.createElement("select",{onChange:function(e){var n=e.target;return t(c.find(function(e){return e.id===n.value}))},value:n},s.a.createElement("option",{value:void 0}," ","-- select an animation folder or video file --"," "),c.map(function(e){var t=e.id,n=e.name;return s.a.createElement("option",{key:t,value:t},n)}))}n.d(t,"default",function(){return E});var y=function(e,t){return Object(a.a)({},e,t)};function E(e){var t=e.save,n=e.selectedFolder,c=e.files,f=(Object(r.a)(e,["save","selectedFolder","files"]),{selectedFolder:n,files:c}),h=Object(l.useState)(!0),v=Object(o.a)(h,2),b=v[0],g=v[1],j=Object(l.useReducer)(y,f),E=Object(o.a)(j,2),x=E[0],F=E[1],P=x.selectedFolder,k=x.files;return function(e,t){var n=Object(l.useState)(null),r=Object(o.a)(n,2),c=r[0],s=r[1],f=Object(p.n)().client;Object(l.useEffect)(function(){function t(){return(t=Object(u.a)(i.a.mark(function t(){var n,r,c;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,f.filesListFolder({path:e.path_display});case 2:return n=t.sent,t.next=5,Promise.all(n.entries.map(function(){var e=Object(u.a)(i.a.mark(function e(t){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.sharingCreateSharedLink({path:t.path_display});case 2:return n=e.sent,e.abrupt("return",Object(a.a)({},t,n,{index:parseInt(/\d+/g.exec(t.name)[0],10),url:n.url.replace(/.$/,"1")}));case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 5:r=t.sent,c=r.sort(function(e,t){return e.index-t.index}),s(c);case 8:case"end":return t.stop()}},t)}))).apply(this,arguments)}e&&function(){t.apply(this,arguments)}()},[e]),Object(l.useEffect)(function(){t(c)},[c])}(P||n,function(e){return F({files:e})}),Object(l.useEffect)(function(){g(d()(f,x))},[x]),s.a.createElement("div",null,s.a.createElement(w,{onSelectFolder:function(e){return F({selectedFolder:e,files:null})},selectedFolderId:P?P.id:n}),P&&(Array.isArray(k)?s.a.createElement(O,{frames:k.map(function(e){return e.url})}):s.a.createElement(m.a,null)),s.a.createElement("button",{disabled:b,onClick:function(){return t(x)},title:b?"No changes to save":null},"Save animation"))}}}]);
//# sourceMappingURL=4.ba049932.chunk.js.map