(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{145:function(e,t,n){},175:function(e,t,n){},176:function(e,t,n){"use strict";n.r(t);var a,r,c,o=n(1),l=n(0),i=n.n(l),u=n(17),s=n.n(u),m=n(52),d=n.n(m),f=n(27),p=n(2),b=n(3),j=n.n(b),v=n(11),E=n(4),O=n(10),h=n.n(O),y=n(28),g=n.n(y),S=n(5),w=n.n(S),P=n(12),x=n.n(P),k="imageCollection",C="prose",I="motion",N=[k,C,I],A=["moodBoard","storyBoard","styleFrames"],F=(a={},Object(E.a)(a,C,C),Object(E.a)(a,I,I),Object(E.a)(a,k,["moodBoard","storyBoard","styleFrames"]),a),D=(r={},Object(E.a)(r,k,"Image collection"),Object(E.a)(r,C,"Script"),Object(E.a)(r,I,"Animation"),r),L=(c={},Object(E.a)(c,"moodBoard","Mood board"),Object(E.a)(c,"storyBoard","Story board"),Object(E.a)(c,"styleFrames","Style frames"),c),R=w.a.oneOf(N),B=w.a.oneOf(A),T=w.a.shape({id:w.a.string,name:w.a.string,type:R.isRequired,subtype:B}),U=(w.a.shape({name:w.a.string,sections:w.a.arrayOf(T)}),{overviewLink:"Overview"}),_=[{id:x()("Script"),name:"Script",type:C},{id:x()("Mood board"),name:"Mood board",type:k,subtype:"moodBoard"},{id:x()("Story board"),name:"Story board",type:k,subtype:"storyBoard"},{id:x()("Style frames"),name:"Style frames",type:k,subtype:"styleFrames"},{id:x()("Animation"),name:"Animation",type:I}];var M,W=(M="projects","".concat("anni-pma-").concat(M)),J=[],H=function(){var e=Object(v.a)(j.a.mark(function e(){var t;return j.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.a.getItem(W);case 3:if(t=e.sent){e.next=8;break}return e.next=7,g.a.setItem(W,J);case 7:return e.abrupt("return",J);case 8:return e.abrupt("return",t);case 11:e.prev=11,e.t0=e.catch(0);case 13:case"end":return e.stop()}},e,null,[[0,11]])}));return function(){return e.apply(this,arguments)}}();function G(e){if(e)return g.a.setItem(W,e)}var V=f.a,$=d()({clientId:"swbiv6r9kwfs4os",authRedirect:V}),q=($.DropboxContext,$.DropboxProvider),z=$.useDropboxClient;function K(e){var t=e.children;return i.a.createElement(q,null,t)}n(145);var Q=n(6),X=n(8),Y=function(e){var t="/project-manager-application";return"/"===e?"".concat(t,"/"):"".concat(t,"/").concat(e,"/")},Z={projectNameLabel:"Project name",projectNamePlaceholder:"Project B",noProjects:"No projects",createProject:"Create project",removeProject:"Remove project",removeProjectAriaLabel:"Remove {name} project",errorProjectNameTaken:"Sorry, that project name is already taken."},ee=function(e){return Z.removeProjectAriaLabel.replace(/\{.*?\}/,e)};function te(e){var t=e.id,n=e.name,a=e.removeProject;return i.a.createElement("div",null,i.a.createElement("h3",null,i.a.createElement(X.a,{to:Y(t)},n)),i.a.createElement("button",{"aria-label":ee(n),onClick:function(){return a(n)}},Z.removeProject))}var ne="projectNameErrorId";function ae(e){var t=e.addProject,n=e.validateProject,a=Object(l.useState)(""),r=Object(o.a)(a,2),c=r[0],u=r[1],s=Object(l.useState)(null),m=Object(o.a)(s,2),d=m[0],f=m[1];return i.a.createElement("form",{onSubmit:function(e){if(e.preventDefault(),c){var a,r=(a=c,{id:x()(a),name:a,sections:_}),o=n(r);null===o?(t(r),u("")):f(o)}}},i.a.createElement("label",{htmlFor:"projectName"},Z.projectNameLabel,i.a.createElement("input",{"aria-describedby":d&&ne,"aria-invalid":!!d||null,id:"projectName",type:"text",className:"input",placeholder:Z.projectNamePlaceholder,value:c,onChange:function(e){f(null),u(e.target.value)}})),d&&i.a.createElement("p",{style:{color:"magenta"},id:ne},d.message),i.a.createElement("button",{type:"submit"},Z.createProject))}function re(e){var t=e.projects,n=e.setProjects,a=function(e){return n(t.filter(function(t){return t.name!==e}))};return i.a.createElement("div",null,i.a.createElement("h2",null,"Projects"),0===t.length&&i.a.createElement("p",null,Z.noProjects),t.map(function(e){return i.a.createElement(te,Object.assign({},e,{key:e.name,removeProject:a}))}),i.a.createElement(ae,{addProject:function(e){return n([].concat(Object(Q.a)(t),[e]))},validateProject:function(e){var n=e.name;return t.find(function(e){return e.name===n})?{message:Z.errorProjectNameTaken}:null}}))}var ce=n(54),oe="PROJECT_SECTION",le="PROJECT_SECTION_NAV",ie="404 - Page not found",ue=function(){return i.a.createElement("div",null,i.a.createElement("h1",null,ie))},se=n(14),me=function(){return i.a.createElement("div",null,"Loading...")},de=i.a.lazy(function(){return Promise.all([n.e(2),n.e(4)]).then(n.bind(null,352))});function fe(e){return i.a.createElement("div",null,i.a.createElement(l.Suspense,{fallback:i.a.createElement(me,null)},i.a.createElement(de,e)))}var pe=n(55),be=n.n(pe),je=n(56),ve=n.n(je),Ee=n(21),Oe=Object(Ee.SortableHandle)(function(){return i.a.createElement("span",{style:{border:"1px dotted gold",cursor:"grab",padding:8,display:"inline-block"}},":::")}),he=Object(Ee.SortableElement)(function(e){var t=e.renderItem,n=void 0===t?function(){return"feed me"}:t,a=e.value;return i.a.createElement("li",null,i.a.createElement(Oe,null),"string"===typeof n?a:n(a))}),ye=Object(Ee.SortableContainer)(function(e){var t=e.items,n=e.listStyle,a=void 0===n?{}:n,r=Object(se.a)(e,["items","listStyle"]);return i.a.createElement("ul",{style:a},t.map(function(e,t){return i.a.createElement(he,Object.assign({key:"item-".concat(t),index:t,value:e},r))}))}),ge=["Item 1","Item 2","Item 3","Item 4","Item 5","Item 6"];function Se(e){var t=e.axis,n=void 0===t?"y":t,a=e.defaultItems,r=void 0===a?ge:a,c=e.onReorder,u=void 0===c?function(){return null}:c,s=Object(se.a)(e,["axis","defaultItems","onReorder"]),m=Object(l.useState)(r),d=Object(o.a)(m,2),f=d[0],p=d[1];Object(l.useEffect)(function(){var e=ve()(r,f);e.length>0&&p([].concat(Object(Q.a)(f),Object(Q.a)(e)))}),Object(l.useEffect)(function(){r!==f&&p(r)},[r]);return i.a.createElement(ye,Object.assign({},s,{axis:n,items:f,onSortEnd:function(e){var t=e.oldIndex,n=e.newIndex,a=Object(Ee.arrayMove)(f,t,n);u(a),p(a)},useDragHandle:!0}))}function we(e){var t=e.removeFile;return function(e){var n=e.file,a=e.id,r=e.url,c=e.preview,o=e.title,l=e.description;return i.a.createElement("figure",{style:{maxWidth:300,position:"relative"}},i.a.createElement("img",{src:r||c,alt:o||l||n&&n.name,style:{maxWidth:"100%",height:"auto"}}),i.a.createElement("figcaption",null,l),i.a.createElement("button",{onClick:function(){return t(a)}},"\xd7 delete"))}}var Pe={display:"flex",flexWrap:"wrap"},xe="imageCollectionUploadInput";function ke(e){var t=Object(l.useState)(e),n=Object(o.a)(t,2);return{isFileDropActive:n[0],setIsActive:n[1]}}function Ce(e){var t=e.children,n=e.onDrop,a=ke(!1),r=a.isFileDropActive,c=a.setIsActive;return i.a.createElement("div",{onDropCapture:function(e){var t;e.preventDefault(),e.preventDefault(),(t=e.dataTransfer.items?Object(Q.a)(e.dataTransfer.items).filter(function(e){return"file"===e.kind}).map(function(e){return e.getAsFile()}):Object(Q.a)(e.dataTransfer.files))&&n(t)},onDragOverCapture:function(e){e.preventDefault(),c(!0)},onDragLeaveCapture:function(){return c(!1)},style:{padding:8,background:r?"MediumSpringGreen":"transparent"}},t)}function Ie(e){return Ne.apply(this,arguments)}function Ne(){return(Ne=Object(v.a)(j.a.mark(function e(t){var n,a,r,c,o,l,i;return j.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.newFiles,a=t.collection,r=t.save,c=t.uploadImage,e.next=3,Promise.all(n.map(function(e){var t=e.file;return c({file:t})}));case 3:o=e.sent,l=o.reduce(function(e,t,a){var r=t.url;return Object(p.a)({},e,Object(E.a)({},n[a].id,r))},{}),i=a.map(function(e){var t=l[e.id];return t?Object(p.a)({},e,{url:t,uploaded:!0}):e}),r({collection:i});case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Ae(e){var t=e.collection,n=e.save,a=Object(l.useState)(t||[]),r=Object(o.a)(a,2),c=r[0],u=r[1],s=Object(l.useState)(!1),m=Object(o.a)(s,2),d=m[0],f=m[1],b=Object(l.useState)(null),E=Object(o.a)(b,2),O=E[0],y=E[1],g=Object(l.useState)(!1),S=Object(o.a)(g,2),w=S[0],P=S[1],x=ke().isFileDropActive,k=function(e){e&&function(e){var n=!h()(t,e||c);return P(n),n}(e)&&u(e)};function C(e){var t=e.map(function(e){return{id:be()(e.name),name:e.name,file:e,preview:URL.createObjectURL&&URL.createObjectURL(e),uploaded:!1}});k([].concat(Object(Q.a)(c),Object(Q.a)(t)))}function I(){return(I=Object(v.a)(j.a.mark(function a(){var r;return j.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(y(null),!(r=c.filter(function(e){return!e.uploaded})).length){a.next=9;break}return f(!0),a.next=6,Ie(Object(p.a)({},e,{collection:c,newFiles:r,save:n})).catch(y);case 6:f(!1),a.next=10;break;case 9:h()(t,c)||n({collection:c});case 10:case"end":return a.stop()}},a)}))).apply(this,arguments)}return Object(l.useEffect)(function(){k(t)},[t]),i.a.createElement(Ce,{onDrop:C},c.length>0?i.a.createElement(Se,{axis:"xy",defaultItems:c,listStyle:Pe,onReorder:k,renderItem:we({removeFile:function(e){k(c.filter(function(t){return t.id!==e}))}})}):i.a.createElement("p",null,"No images."),i.a.createElement("label",{htmlFor:xe},"Upload image ",x&&"ACTIVE!"),i.a.createElement("input",{id:xe,name:xe,type:"file",accept:"image/png, image/jpeg",multiple:!0,onChange:function(e){var t=e.target;C(Object(Q.a)(t.files))}}),d?"Saving...":i.a.createElement("button",{disabled:!w,onClick:function(){return I.apply(this,arguments)}},"Save"),O&&i.a.createElement("p",{style:{color:"red"}},O.message))}function Fe(e){var t=e.onSelectFolder,n=e.selectedFolderId,a=Object(l.useState)(null),r=Object(o.a)(a,2),c=r[0],u=r[1],s=z().client;return Object(l.useEffect)(function(){function e(){return(e=Object(v.a)(j.a.mark(function e(){var t,n;return j.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.filesListFolder({path:""});case 2:t=e.sent,n=t.entries.filter(function(e){return"folder"===e[".tag"]&&"images"!==e.name}),u(n);case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}!function(){e.apply(this,arguments)}()},[]),null===c?i.a.createElement(me,null):i.a.createElement("select",{onChange:function(e){var n=e.target;return t(c.find(function(e){return e.id===n.value}))},value:n},i.a.createElement("option",{value:void 0}," ","-- select an animation folder or video file --"," "),c.map(function(e){var t=e.id,n=e.name;return i.a.createElement("option",{key:t,value:t},n)}))}Ae.defaultProps={uploadImage:console.log};var De=function(e,t){return Object(p.a)({},e,t)};function Le(e){var t=e.save,n=e.selectedFolder,a=e.files,r=(Object(se.a)(e,["save","selectedFolder","files"]),{selectedFolder:n,files:a}),c=Object(l.useState)(!0),u=Object(o.a)(c,2),s=u[0],m=u[1],d=Object(l.useReducer)(De,r),f=Object(o.a)(d,2),b=f[0],E=f[1],O=b.selectedFolder,y=b.files;return function(e,t){var n=Object(l.useState)(null),a=Object(o.a)(n,2),r=a[0],c=a[1],i=z().client;Object(l.useEffect)(function(){function t(){return(t=Object(v.a)(j.a.mark(function t(){var n,a,r;return j.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.filesListFolder({path:e.path_display});case 2:return n=t.sent,t.next=5,Promise.all(n.entries.map(function(){var e=Object(v.a)(j.a.mark(function e(t){var n;return j.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.sharingCreateSharedLink({path:t.path_display});case 2:return n=e.sent,e.abrupt("return",Object(p.a)({},t,n,{index:parseInt(/\d+/g.exec(t.name)[0],10),url:n.url.replace(/.$/,"1")}));case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 5:a=t.sent,r=a.sort(function(e,t){return e.index-t.index}),c(r);case 8:case"end":return t.stop()}},t)}))).apply(this,arguments)}e&&function(){t.apply(this,arguments)}()},[e]),Object(l.useEffect)(function(){t(r)},[r])}(O||n,function(e){return E({files:e})}),Object(l.useEffect)(function(){m(h()(r,b))},[b]),i.a.createElement("div",null,i.a.createElement(Fe,{onSelectFolder:function(e){return E({selectedFolder:e,files:null})},selectedFolderId:O?O.id:n}),O&&(Array.isArray(y)?i.a.createElement("ul",{style:{display:"flex",flexWrap:"wrap",listStyle:"none"}},y.map(function(e){return i.a.createElement("li",{key:e.id},i.a.createElement("img",{src:e.url,width:100,alt:e.name}))})):i.a.createElement(me,null)),i.a.createElement("button",{disabled:s,onClick:function(){return t(b)},title:s?"No changes to save":null},"Save animation"))}function Re(e){var t=e.updateProjectSection,n=Object(se.a)(e,["updateProjectSection"]),a=n.id,r=n.name,c=n.project,o=n.subtype,l=n.type,u=Object(p.a)({},n,{save:function(e){return t(c.id,a,e)}});return i.a.createElement("div",{"data-testid":oe},i.a.createElement("h1",null,c.name," - ",r),function(e,t){switch(e){case C:return i.a.createElement(fe,t);case k:return i.a.createElement(Ae,t);case I:return i.a.createElement(Le,t);default:return i.a.createElement("div",null,"Section content pending for type: ",e)}}(l,u),o&&" - ".concat(o))}function Be(e){var t=e.project;return i.a.createElement("div",{"data-testid":oe},i.a.createElement("h1",null,t.name),i.a.createElement("p",null,t.details))}var Te={newProjectSectionNameLabel:"New project section name",newProjectSectionNamePlaceholder:"Section name",saveNewProjectSectionButtonLabel:"Add new project section"},Ue="type",_e="subtype",Me={name:"",type:k,subtype:"moodBoard"},We=function(e,t){return e===t.type},Je=function(e,t){return e===t.subtype},He=function(e,t){return Object(p.a)({},e,t)};function Ge(e){var t=e.saveNewSection,n=Object(l.useReducer)(He,Me),a=Object(o.a)(n,2),r=a[0],c=a[1],u=function(e){return c({subtype:e})};return i.a.createElement("form",{onSubmit:function(e){e.preventDefault(),t(Object(p.a)({},r,{id:x()(r.name)})),c(Me)}},i.a.createElement("label",null,Te.newProjectSectionNameLabel,i.a.createElement("input",{value:r.name,onChange:function(e){var t,n=e.target;return t=n.value,c({name:t})},name:"newProjectSectionName",placeholder:Te.newProjectSectionNamePlaceholder})),i.a.createElement("ul",null,Object.entries(F).map(function(e){var t=Object(o.a)(e,2),n=t[0],a=t[1];return i.a.createElement("li",{key:n},i.a.createElement("label",null,i.a.createElement("input",{checked:We(n,r),type:"radio",name:Ue,onChange:function(){return function(e){c({type:e}),u(Array.isArray(F[e])?F[e][0]:null)}(n)},value:n}),D[n]),We(n,r)&&Array.isArray(a)&&i.a.createElement("ul",null,a.map(function(e){return i.a.createElement("li",{key:e},i.a.createElement("label",null,i.a.createElement("input",{checked:Je(e,r),type:"radio",name:_e,onChange:function(){return u(e)},value:n}),L[e]))})))})),i.a.createElement("button",{type:"submit"},Te.saveNewProjectSectionButtonLabel))}var Ve={cancel:"Cancel",saveChanges:"Save Changes"};function $e(e){var t=e.project,n=e.updateProject,a=e.toggleEditing,r=Object(l.useState)(t),c=Object(o.a)(r,2),u=c[0],s=c[1],m=u.sections;return i.a.createElement("div",null,i.a.createElement(Se,{defaultItems:m,onReorder:function(e){return s(Object(p.a)({},t,{sections:e}))},renderItem:function(e){var t=e.name;return i.a.createElement("strong",null,t)}}),i.a.createElement(Ge,{project:u,saveNewSection:function(e){s({id:t.id,sections:[].concat(Object(Q.a)(m),[e])})}}),i.a.createElement("button",{onClick:function(){n(u),a()}},Ve.saveChanges),i.a.createElement("button",{onClick:a},Ve.cancel))}var qe=Object(ce.a)(function(e){return e.projects},function(e){return e.projectId},function(e,t){return e.find(function(e){return e.id===t})});function ze(e){var t=Object(l.useState)(!1),n=Object(o.a)(t,2),a=n[0],r=n[1],c=qe(e),u=e.updateProject,s=e.updateProjectSection,m=e.uploadImage;if(!c)return i.a.createElement(ue,null);var d=i.a.createElement("ul",{"data-testid":le},i.a.createElement("li",null,i.a.createElement(X.a,{to:"./"},U.overviewLink)),c.sections.map(function(e,t){var n=e.id,a=e.name;return i.a.createElement("li",{key:n},i.a.createElement(X.a,{to:n},a))}),i.a.createElement("li",null,i.a.createElement("button",{onClick:function(){return r(!0)}},"Edit project sections"))),f=i.a.createElement($e,{project:c,toggleEditing:function(){return r(!1)},updateProject:u});return i.a.createElement("div",null,i.a.createElement(X.b,null,i.a.createElement(Be,{default:!0,project:c}),c.sections.map(function(e,t){return i.a.createElement(Re,Object.assign({key:e.id,path:e.id,project:c,updateProjectSection:s,uploadImage:m},e))})),a?f:d)}ze.defaultProps={updateProject:function(){return null}};var Ke,Qe="abce".split("").map(function(e){return{id:"project-".concat(e),name:"Project ".concat(e.toUpperCase()),details:"Details about project ".concat(e.toUpperCase()),sections:_}}),Xe=(n(175),Y("/")),Ye=function(){return i.a.createElement("div",null,"Home")};function Ze(e){var t=e.client,n=e.authUrl,a=e.logout,r=Object(l.useState)(null),c=Object(o.a)(r,2),u=c[0],s=c[1];return Object(l.useEffect)(function(){t&&(window.history.pushState("",document.title,window.location.pathname+window.location.search),t.usersGetCurrentAccount().then(s))},[]),t?u?i.a.createElement("div",null,i.a.createElement("div",null,i.a.createElement("h2",null,u.name.familiar_name),i.a.createElement("img",{style:{borderRadius:"50%"},with:50,height:50,src:u.profile_photo_url,alt:u.name.display_name}),i.a.createElement("button",{onClick:a},"Logout"))):i.a.createElement(me,null):i.a.createElement("a",{href:n},"Login to Dropbox")}function et(e){var t=e.defaultProjects,n=void 0===t?Qe:t,a=Object(l.useState)(!1),r=Object(o.a)(a,2),c=r[0],u=r[1],s=z(),m=s.client,d=s.updateDatabase,b=s.uploadImage;Ke=n;var j=Object(l.useState)(n),v=Object(o.a)(j,2),E=v[0],O=v[1];function y(e){O(E.map(function(t){return t.id===e.id?Object(p.a)({},t,e):t}))}return Object(l.useEffect)(function(){m||(window.location.href=f.a)},[m]),Object(l.useEffect)(function(){m&&!h()(Ke,E)&&(G(E),d({data:{projects:E}}),Ke=E)}),i.a.createElement("div",{className:"App"},i.a.createElement("header",null,"Anni Project Manager Application",i.a.createElement("ul",null,i.a.createElement("li",null,i.a.createElement(X.a,{to:Xe},"Home")),m&&i.a.createElement("li",null,i.a.createElement(X.a,{to:Y("dashboard")},"Dashboard")),i.a.createElement("li",null,i.a.createElement(Ze,s)))),i.a.createElement(X.b,null,i.a.createElement(Ye,{path:Y("/")}),i.a.createElement(re,{path:Y("dashboard"),projects:E,setProjects:O}),i.a.createElement(ze,{path:Y(":projectId/*"),projects:E,updateProject:y,updateProjectSection:function(e,t,n){var a=E.find(function(t){return t.id===e}),r=a.sections.find(function(e){return e.id===t});a&&r&&y(Object(p.a)({},a,{sections:a.sections.map(function(e){return delete e.editorContent,e.id===t?Object(p.a)({},e,n):e})}))},uploadImage:b}),i.a.createElement(ue,{default:!0})),i.a.createElement("footer",{style:{padding:"100px 20px",background:"MintCream",float:"right"}},i.a.createElement("button",{onClick:function(){return u(!c)}},"Debug State"),c&&i.a.createElement("pre",{style:{background:"lavender",padding:10}},JSON.stringify(E,null,2))))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var tt=document.getElementById("root");function nt(e){var t=e.children;return i.a.createElement("div",{className:"PresentationPanel"},t)}function at(){var e=z().authUrl;return i.a.createElement(nt,null,i.a.createElement("div",null,i.a.createElement("h1",null,"Anni"),i.a.createElement("a",{href:e},"Login with Dropbox")))}s.a.render(i.a.createElement(K,null,i.a.createElement(function(){var e=z(),t=e.client,n=e.readDatabase,a=Object(l.useState)(null),r=Object(o.a)(a,2),c=r[0],u=r[1];return Object(l.useEffect)(function(){t&&n().then(function(e){e?u(e.projects):H().then(u)})},[]),t?c?i.a.createElement(K,null,i.a.createElement(et,{defaultProjects:c})):i.a.createElement(nt,null,i.a.createElement(me,null)):i.a.createElement(at,null)},null)),tt),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},27:function(e){e.exports={a:"https://anni.io/project-manager-application"}},58:function(e,t,n){e.exports=n(176)}},[[58,1,3]]]);
//# sourceMappingURL=main.b6c1fbee.chunk.js.map