(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{352:function(e,t,n){var r=n(353),a=n(34),o="Expected a function";e.exports=function(e,t,n){var i=!0,u=!0;if("function"!=typeof e)throw new TypeError(o);return a(n)&&(i="leading"in n?!!n.leading:i,u="trailing"in n?!!n.trailing:u),r(e,t,{leading:i,maxWait:t,trailing:u})}},353:function(e,t,n){var r=n(34),a=n(354),o=n(355),i="Expected a function",u=Math.max,s=Math.min;e.exports=function(e,t,n){var c,l,f,p,d,h,m=0,g=!1,v=!1,y=!0;if("function"!=typeof e)throw new TypeError(i);function w(t){var n=c,r=l;return c=l=void 0,m=t,p=e.apply(r,n)}function b(e){var n=e-h;return void 0===h||n>=t||n<0||v&&e-m>=f}function P(){var e=a();if(b(e))return F(e);d=setTimeout(P,function(e){var n=t-(e-h);return v?s(n,f-(e-m)):n}(e))}function F(e){return d=void 0,y&&c?w(e):(c=l=void 0,p)}function x(){var e=a(),n=b(e);if(c=arguments,l=this,h=e,n){if(void 0===d)return function(e){return m=e,d=setTimeout(P,t),g?w(e):p}(h);if(v)return d=setTimeout(P,t),w(h)}return void 0===d&&(d=setTimeout(P,t)),p}return t=o(t)||0,r(n)&&(g=!!n.leading,f=(v="maxWait"in n)?u(o(n.maxWait)||0,t):f,y="trailing"in n?!!n.trailing:y),x.cancel=function(){void 0!==d&&clearTimeout(d),m=0,c=h=l=d=void 0},x.flush=function(){return void 0===d?p:F(a())},x}},354:function(e,t,n){var r=n(9);e.exports=function(){return r.Date.now()}},355:function(e,t,n){var r=n(34),a=n(60),o=NaN,i=/^\s+|\s+$/g,u=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,c=/^0o[0-7]+$/i,l=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(a(e))return o;if(r(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=r(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(i,"");var n=s.test(e);return n||c.test(e)?l(e.slice(2),n?2:8):u.test(e)?o:+e}},359:function(e,t,n){"use strict";n.r(t);var r,a,o=n(22),i=n(3),u=n(10),s=n.n(u),c=n(21),l=n(2),f=n(0),p=n.n(f),d=n(14),h=n.n(d),m=n(12),g=n(1),v=(n(5),n(352)),y=n.n(v),w=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};var b=(a=r=function(e){function t(n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,e.call(this,n));return r.pauseAudio=function(){r.audio&&r.audio.pause()},r.registerAudio=function(e){r.audio=e},r.state={currentTime:n.currentTime,isReady:!1,volume:n.volume},r}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.componentDidMount=function(){var e=this;this.pauseAudio(),this.audio.addEventListener("canplaythrough",function(){e.setState({isReady:!0},e.props.onReady)})},t.prototype.componentWillReceiveProps=function(e){var t=this,n=e.currentTime,r=e.playing,a=e.playAudio,o=e.volume;this.state.isReady&&(this.audio.muted=!a||!1,this.state.currentTime>n?this.audio.currentTime=n:y()(function(){t.pauseAudio(),t.audio.currentTime=n,t.audio.play()},100),this.setState({currentTime:n,volume:o}),r&&this.audio.paused?this.audio.play():r||this.pauseAudio(),o!==this.state.volume&&(this.audio.volume=o))},t.prototype.render=function(){var e=this.props,t=e.src,n=e.showControls,r=e.trackProps;return p.a.createElement("audio",{controls:n,ref:this.registerAudio,src:t},p.a.createElement("track",w({kind:"captions"},r)))},t}(f.Component),r.defaultProps={currentTime:0,playing:!1,playAudio:!1,onReady:function(){return null},showControls:!1,src:"",trackProps:{},volume:.5},a);b.propTypes={};var P,F,x,O=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},E=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var j=(F=P=function(e){function t(n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,e.call(this,n));x.call(r);var a=n.frames;return r.state={audioReady:!1,currentFrame:0,fps:n.fps,loading:!0,isPlaying:!1,htmlImageElements:null,playAudio:!0,volume:.5,loadingProgress:{loadingComplete:!1,totalLoaded:0,totalFramesToLoad:a.length}},window.onkeydown=r.handleKeydown,r}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.componentDidMount=function(){var e=this,t=this.props.frames;this.canvas&&(this.ctx=this.canvas.getContext("2d"));var n=[];t.forEach(function(r,a){!function(e,t){var n=new Image;n.onload=function(){return t(n)},n.src=e}(r,function(r){e.setState({loadingProgress:O({},e.state.loadingProgress,{totalLoaded:n.length})}),0===a&&(e.framesSize={width:r.width,height:r.height}),n.splice(a,0,r),n.length===t.length&&e.setState({loading:!1,htmlImageElements:n,loadingProgress:O({},e.state.loadingProgress,{loadingComplete:!0})},e.drawFrame)})})},t.prototype.componentWillUnmount=function(){window.onkeydown=null},t.prototype.getNextFrame=function(){var e=this.state.currentFrame;return e===this.props.frames.length-1?0:e+1},t.prototype.getPrevFrame=function(){var e=this.state.currentFrame,t=this.props.frames;return 0===e?t.length-1:e-1},t.prototype.render=function(){var e=this,t=this.currentAudioPosition,n=this.state||{},r=n.isPlaying,a=n.fps,o=n.playAudio,i=n.volume,u=n.loadingProgress,s=this.props,c=s.audioSource,l=s.frames,f=s.render,d=o&&p.a.createElement(b,{src:c,playAudio:o,onReady:this.onAudioReady,playing:r,maxTime:l.length/a,volume:i,showControls:!0,currentTime:this.currentAudioPosition}),h=this.getViewerProgressProps,m=this.getViewerControlsProps,g=function(t){e.canvas=t},v=p.a.createElement("canvas",{ref:g});return f(O({},this.state,{getViewerProgressProps:h,getViewerControlsProps:m,loadingProgress:u,renderAudio:d,renderViewer:v,getCanvasRef:g,currentAudioPosition:t,isPlaying:r}))},E(t,[{key:"isLoading",get:function(){return!this.state.audioReady&&this.state.loading}},{key:"currentAudioPosition",get:function(){var e=this.state,t=e.currentFrame,n=e.fps;return 0===t?0:t/n}}]),t}(f.Component),P.defaultProps={audioSource:"",fps:24},x=function(){var e=this;this.onVolumeChange=function(t){e.setState({volume:t})},this.onAudioReady=function(){e.setState({audioReady:!0})},this.getViewerControlsProps=function(){var t=e.pause,n=e.togglePlay,r=e.toggleAudio,a=e.onVolumeChange,o=e.state||{},i=o.currentFrame,u=o.isPlaying,s=o.fps,c=o.playAudio,l=o.volume;return{fps:s,loading:e.isLoading,currentFrame:i,isPlaying:u,next:e.goToNextFrame,prev:e.goToPrevFrame,pause:t,playAudio:c,togglePlay:n,toggleAudio:r,volume:l,onVolumeChange:a,onFPSChange:function(t){return e.setState({fps:parseInt(t,10)})}}},this.getViewerProgressProps=function(){var t=(e.state||{}).currentFrame;return{min:0,max:e.props.frames.length-1,value:t,onChange:e.goToFrame}},this.goToFrame=function(t){e.setState({currentFrame:t},e.drawFrame)},this.goToNextFrame=function(){e.setState({currentFrame:e.getNextFrame()},e.drawFrame)},this.goToPrevFrame=function(){e.setState({currentFrame:e.getPrevFrame()},e.drawFrame)},this.drawFrame=function(){var t=e.state,n=t.currentFrame,r=t.htmlImageElements;if(r){var a=r[n];e.canvas&&e.ctx&&(e.canvas.width=a.width,e.canvas.height=a.height,e.ctx.drawImage(a,0,0,a.width,a.height,0,0,a.width,a.height))}},this.pause=function(){e.setState({isPlaying:!1})},this.togglePlay=function(){e.setState({isPlaying:!e.state.isPlaying},function(){e.state.isPlaying&&e.play(e.renderNextFrame)})},this.toggleAudio=function(){e.setState({playAudio:!e.state.playAudio})},this.play=function(t){if(e.state.isPlaying){var n=performance.now(),r=void 0,a=void 0;!function o(){if(e.state.isPlaying){r=performance.now(),a=r-n;var i=Math.round(1e3/e.state.fps);a>i&&(t(),n=r),requestAnimationFrame(o)}}()}},this.handleKeydown=function(t){switch(t.which){case 39:t.preventDefault(),e.goToNextFrame();break;case 37:t.preventDefault(),e.goToPrevFrame();break;case 32:t.preventDefault(),e.togglePlay()}},this.renderNextFrame=function(){e.state.isPlaying&&e.setState({currentFrame:e.getNextFrame()},e.drawFrame)}},F);function T(e){var t=e.onSelectFolder,n=e.selectedFolderId,r=Object(f.useState)(null),a=Object(l.a)(r,2),o=a[0],i=a[1],u=Object(g.n)().client;return Object(f.useEffect)(function(){function e(){return(e=Object(c.a)(s.a.mark(function e(){var t,n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.filesListFolder({path:""});case 2:t=e.sent,n=t.entries.filter(function(e){return"folder"===e[".tag"]&&"images"!==e.name}),i(n);case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}!function(){e.apply(this,arguments)}()},[]),null===o?p.a.createElement(m.a,null):p.a.createElement("select",{onChange:function(e){var n=e.target;return t(o.find(function(e){return e.id===n.value}))},value:n},p.a.createElement("option",{value:void 0}," ","-- select an animation folder or video file --"," "),o.map(function(e){var t=e.id,n=e.name;return p.a.createElement("option",{key:t,value:t},n)}))}j.propTypes={},n.d(t,"default",function(){return S});var A=function(e,t){return Object(i.a)({},e,t)};function S(e){var t=e.save,n=e.selectedFolder,r=e.files,a=(Object(o.a)(e,["save","selectedFolder","files"]),{selectedFolder:n,files:r}),u=Object(f.useState)(!0),d=Object(l.a)(u,2),v=d[0],y=d[1],w=Object(f.useReducer)(A,a),b=Object(l.a)(w,2),P=b[0],F=b[1],x=P.selectedFolder,O=P.files;return function(e,t){var n=Object(f.useState)(null),r=Object(l.a)(n,2),a=r[0],o=r[1],u=Object(g.n)().client;Object(f.useEffect)(function(){function t(){return(t=Object(c.a)(s.a.mark(function t(){var n,r,a;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.filesListFolder({path:e.path_display});case 2:return n=t.sent,t.next=5,Promise.all(n.entries.map(function(){var e=Object(c.a)(s.a.mark(function e(t){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.sharingCreateSharedLink({path:t.path_display});case 2:return n=e.sent,e.abrupt("return",Object(i.a)({},t,n,{index:parseInt(/\d+/g.exec(t.name)[0],10),url:n.url.replace(/.$/,"1")}));case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 5:r=t.sent,a=r.sort(function(e,t){return e.index-t.index}),o(a);case 8:case"end":return t.stop()}},t)}))).apply(this,arguments)}e&&function(){t.apply(this,arguments)}()},[e]),Object(f.useEffect)(function(){t(a)},[a])}(x||n,function(e){return F({files:e})}),Object(f.useEffect)(function(){y(h()(a,P))},[P]),p.a.createElement("div",null,p.a.createElement(T,{onSelectFolder:function(e){return F({selectedFolder:e,files:null})},selectedFolderId:x?x.id:n}),x&&(Array.isArray(O)?p.a.createElement("div",null,p.a.createElement(j,{frames:O.map(function(e){return e.url}),render:function(e){var t=e.renderViewer;return p.a.createElement("div",null,t)}})):p.a.createElement(m.a,null)),p.a.createElement("button",{disabled:v,onClick:function(){return t(P)},title:v?"No changes to save":null},"Save animation"))}}}]);
//# sourceMappingURL=4.1d93f04c.chunk.js.map